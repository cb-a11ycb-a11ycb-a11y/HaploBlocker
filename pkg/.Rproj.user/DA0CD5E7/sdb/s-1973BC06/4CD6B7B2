{
    "collab_server" : "",
    "contents" : "# Experimental GBLUP\nargs <- commandArgs(TRUE)\n#args <- c(10,0.8,\"KE&PE_joined\", 10)\nblock_min <- as.numeric(args[1])\n\nname <- paste0(\"KE\",\"_DH_chromo\",1,\".RData\")\nload(name)\nsource('ML_REML.r')\nlibrary(BGLR)\n\nlibrary(HaploBlocker)\nlibrary(CHaploBlocker)\nblocklist <- block_calculation(data, block_min_count=block_min)\nt <- coverage_test(blocklist, indi=501, type=\"snp\")\nt2 <- coverage_test(blocklist, indi=501, type=\"snp\", max=100)\nse <- blocklist_startend(blocklist, type=\"snp\")\nl <- se[,2] - se[,1]\n\nsize <- blocklist_size(blocklist)\n\nmean(se[,2]-se[,1])\nmean(t)\nmean(t2)\n\nZ <- data\nstorage.mode(Z) <- \"numeric\"\nB <- generate_blockmatrix(blocklist, 501)\n\n\n# Act like it's DHs\n\n\nB <- B*2\n\np_Z <- rowMeans(Z) / 2\np_B <- rowMeans(B) / 2\n\nP_Z <- matrix(2*(p_Z-0.5), nrow=501, ncol=nrow(Z), byrow=TRUE)\nP_B <- matrix(2*(p_B-0.5), nrow=501, ncol=nrow(B), byrow=TRUE)\nZZ <- t(Z)-P_Z- 1\nBB <- t(B) - P_B - 1\n## A <- Z %*% t(Z) / 2 / sum(p_i*(1-p_i))\nG_Z <- tcrossprod(ZZ)/ (2 * sum(p_Z*(1-p_Z)))\nG_B <- tcrossprod(BB)/ (2 * sum(p_B*(1-p_B)))\n\nG_Z <- G_Z/ mean(diag(G_Z))\nG_B <- G_B / mean(diag(G_B))\n\nEVD1=eigen(G_Z)\nEVD2=eigen(G_B)\n\n\n## Monte Carlo method - Information preserved\nlibrary(BGLR)\nnPC=sum(EVD2$values>1e-5)\n\nPC=EVD2\n\nnRep=100\np <- nrow(Z)\nR_preserved=rep(NA,nRep)\n\nfor(i in 1:nRep){\n  b=rnorm(p)\n  y=scale(t(Z)%*%b)\n  a <- fitREML(y=y, EVD=PC, nSuccess=1, nFailure=1)[[3]]\n  R_preserved[i]=a\n  print(c(i, R_preserved[i]))\n}\n\n## Monte Carlo method - Information added\nlibrary(BGLR)\nPC=EVD1\n\nnRep=100\np <- nrow(B)\nR_added=rep(NA,nRep)\n\nfor(i in 1:nRep){\n  b=rnorm(p)\n  y=scale(t(B)%*%b)\n  a <- fitREML(y=y, EVD=PC, nSuccess=1, nFailure=1)[[3]]\n  R_added[i]=a\n  print(c(i, R_added[i]))\n}\n\nprint(mean(R_preserved))\nprint(mean(R_added))\n\nsave(file=paste0(\"Information6_\",block_min,\"_MAZE.RData\"), list=c(\"R_preserved\", \"R_added\"))\n\n\n\n",
    "created" : 1523004785065.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3837154447",
    "id" : "4CD6B7B2",
    "lastKnownWriteTime" : 1523007266,
    "last_content_update" : 1523007266695,
    "path" : "C:/Users/tpook/Desktop/Monte6_501.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 64,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}