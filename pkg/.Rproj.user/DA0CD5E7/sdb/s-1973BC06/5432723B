{
    "collab_server" : "",
    "contents" : "setwd(\"C:/Users/tpook/Desktop/Genetic_Datasets/\")\ndata1 <- read.table(\"FullDatasets_MAZE_DH/FullData1_sortedv4.txt\")\ndata1 <- data1[-1,-(1:2)]\ndata1 <- as.matrix(data1)\n\nfor(index in 1:nrow(data1)){\n  data1[index,data1[index,]==data1[index,1]] <- 0\n  data1[index,!data1[index,]==data1[index,1]] <- 1\n}\nstorage.mode(data1) <- \"numeric\"\n\npe1 <- data1[,1:313*2]\nke1 <- data1[,331:488*2]\nsave(file=\"C:/Users/tpook/Desktop/MAZE1.RData\", list=c(\"pe1\", \"ke1\"))\n\n\n## Code\ndataset <- pe1 * 2\n\ncorrection_factor <- 1\n\nsnp_share <- 0.005\nnsnp <- ceiling(nrow(dataset) * snp_share)\n\np_Z <- rowMeans(dataset) / 2\nP_Z <- matrix(2*(p_Z-0.5), nrow=ncol(dataset), ncol=nrow(dataset), byrow=TRUE)\nZZ <- t(dataset)-P_Z- 1\nG_Z <- tcrossprod(ZZ)/ (2 * sum(p_Z*(1-p_Z)))\nG_Z <- G_Z/ mean(diag(G_Z)) / correction_factor\n\nEVD1=eigen(G_Z)\n\n\nlibrary(BGLR)\nnRep=10\nR_perserved <- R_perserved_cor <- numeric(nRep)\nR_added <- R_added_cor <- numeric(nRep)\n\nsource(\"C:/Users/tpook/Desktop/manuscript_HD/scripts/ML_REML.r\")\n\nfor(index in 1:nRep){\n  \n  nsample <- sample(1:nrow(dataset), nsnp)\n  subdataset <- dataset[nsample,]\n  #subdataset<- matrix(rbinom(100*10000,1,0.5), nrow=10000, ncol=100)*2\n  p_B <- rowMeans(subdataset) / 2\n  P_B <- matrix(2*(p_B-0.5), nrow=ncol(subdataset), ncol=nrow(subdataset), byrow=TRUE)\n  BB <- t(subdataset) - P_B - 1\n  G_B <- tcrossprod(BB)/ (2 * sum(p_B*(1-p_B)))\n  G_B <- G_B / mean(diag(G_B))/ correction_factor\n  \n  #  G_B <- G_block\n  #  G_B <- G_B / mean(diag(G_B))/ correction_factor\n  EVD2=eigen(G_B)\n  \n  \n  nPC <- sum(EVD2$values>1e-5)\n  PC <- EVD2$vectors[,1:nPC]\n  for(i in 1:ncol(PC)){\n    PC[,i]=PC[,i]*sqrt(EVD2$values[i])\n  }\n  p <- nrow(dataset)\n  b <- rnorm(p)\n  y <- scale(t(dataset)%*%b)\n  R_perserved[index]=fitREML(y=y,EVD=EVD2,nSuccess=1,nFailure=1)[3]\n  print(c(index, R_perserved[index]))\n  \n  nPC <- sum(EVD1$values>1e-5)\n  PC <- EVD1$vectors[,1:nPC]\n  for(i in 1:ncol(PC)){\n    PC[,i]=PC[,i]*sqrt(EVD1$values[i])\n  }\n  p <- nrow(subdataset)\n  b <- rnorm(p)\n  y <- scale(t(subdataset)%*%b)\n  R_added[index]=fitREML(y=y,EVD=EVD1,nSuccess=1,nFailure=1)[3]\n  print(c(index, R_added[index]))\n}\n",
    "created" : 1510001629674.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "132244049",
    "id" : "5432723B",
    "lastKnownWriteTime" : 8028915798818962021,
    "last_content_update" : 1510001634861,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled33"
    },
    "relative_order" : 26,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}