{
    "collab_server" : "",
    "contents" : "# Experimental GBLUP\nargs <- commandArgs(TRUE)\n#args <- c(10,0.8,\"KE&PE_joined\", 10)\nblock_min <- as.numeric(args[1])\n\nname <- paste0(\"out.Chromo1_B.txt.phased.gz\")\ndata <- read.table(name)\ndata <- data[-1,-(1:2)]\n\nlibrary(HaploBlocker)\nlibrary(CHaploBlocker)\nblocklist <- block_calculation(data, block_min_count=block_min)\nt <- coverage_test(blocklist, indi=501, type=\"snp\")\nt2 <- coverage_test(blocklist, indi=501, type=\"snp\", max=100)\nse <- blocklist_startend(blocklist, type=\"snp\")\nl <- se[,2] - se[,1]\n\nsize <- blocklist_size(blocklist)\n\nmean(se[,2]-se[,1])\nmean(t)\nmean(t2)\n\nZ <- (data==\"A\")*2\nstorage.mode(Z) <- \"numeric\"\nB <- generate_blockmatrix(blocklist, ncol(Z))\n\n\n# Act like it's DHs\n\n\nB <- B*2\n\np_Z <- rowMeans(Z) / 2\np_B <- rowMeans(B) / 2\n\nP_Z <- matrix(2*(p_Z-0.5), nrow=ncol(Z), ncol=nrow(Z), byrow=TRUE)\nP_B <- matrix(2*(p_B-0.5), nrow=ncol(Z), ncol=nrow(B), byrow=TRUE)\nZZ <- t(Z)-P_Z- 1\nBB <- t(B) - P_B - 1\n## A <- Z %*% t(Z) / 2 / sum(p_i*(1-p_i))\nG_Z <- tcrossprod(ZZ)/ (2 * sum(p_Z*(1-p_Z)))\nG_B <- tcrossprod(BB)/ (2 * sum(p_B*(1-p_B)))\n\nG_Z <- G_Z/ mean(diag(G_Z))\nG_B <- G_B / mean(diag(G_B))\n\nEVD1=eigen(G_Z)\nEVD2=eigen(G_B)\n\n\n## Monte Carlo method - Information preserved\nlibrary(BGLR)\nnPC=sum(EVD2$values>1e-5)\n\nPC=EVD2$vectors[,1:nPC]\nfor(i in 1:ncol(PC)){ PC[,i]=PC[,i]*sqrt(EVD2$values[i]) }\n\nnRep=50\np <- nrow(Z)\nR_preserved=rep(NA,nRep)\n\nfor(i in 1:nRep){\n  b=rnorm(p)\n  y=scale(t(Z)%*%b)\n\n  fm=BGLR(y=y,ETA=list(list(X=PC,model='BRR',df0=.0001)),df0=.0001,nIter=12000,burnIn=2000,saveAt=paste0(\"BGLR_trash/\", block_min), verbose=F)\n  varU=scan(paste0(\"BGLR_trash/\", block_min, 'ETA_1_varB.dat'))\n  varE=scan(paste0(\"BGLR_trash/\", block_min, 'varE.dat'))\n  h2=varU/(varU+varE)\n  R_preserved[i]=median(h2[-c(1:400)])\n  print(c(i, R_preserved[i]))\n}\n\n## Monte Carlo method - Information added\nlibrary(BGLR)\nnPC=sum(EVD1$values>1e-5)\nPC=EVD1$vectors[,1:nPC]\nfor(i in 1:ncol(PC)){ PC[,i]=PC[,i]*sqrt(EVD1$values[i]) }\n\nnRep=50\np <- nrow(B)\nR_added=rep(NA,nRep)\n\nfor(i in 1:nRep){\n  b=rnorm(p)\n  y=scale(t(B)%*%b)\n\n  fm=BGLR(y=y,ETA=list(list(X=PC,model='BRR',df0=.0001)),df0=.0001,nIter=12000,burnIn=2000,verbose=F, saveAt=paste0(\"BGLR_trash/\", block_min))\n  varU=scan(paste0(\"BGLR_trash/\", block_min, 'ETA_1_varB.dat'))\n  varE=scan(paste0(\"BGLR_trash/\", block_min, 'varE.dat'))\n  h2=varU/(varU+varE)\n  R_added[i]=median(h2[-c(1:400)])\n  print(c(i, R_added[i]))\n}\n\nprint(mean(R_preserved))\nprint(mean(R_added))\n\nsave(file=paste0(\"Information_\",block_min,\"_MAZE.RData\"), list=c(\"R_preserved\", \"R_added\"))\n\n\n\n",
    "created" : 1521191384900.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2899418862",
    "id" : "FB2769E3",
    "lastKnownWriteTime" : 1521193851,
    "last_content_update" : 1521193851724,
    "path" : "C:/Users/tpook/Desktop/Monte5_501.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 60,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}